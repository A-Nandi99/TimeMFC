<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>In-Game Week → Real Time Converter</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.5; }
    label { display: block; margin-top: 10px; }
    input, select { margin-top: 5px; padding: 6px; }
    button { margin-top: 15px; padding: 8px 12px; }
    .hint { color: #555; font-size: 0.9em; }
    .error { color: #b00020; margin-top: 10px; }
    .result { margin-top: 16px; font-weight: bold; }
    .countdown { font-size: 1.2em; color: #006400; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>In-Game Week → Real Time Converter</h1>

  <p class="hint">
    Formula: Total = (weeks − 1) × 30 + remaining.  
    Remaining is IRL minutes between 0 and 30.
  </p>

  <label>
    Timezone:
    <select id="timezone"></select>
  </label>

  <label>
    In-game weeks (including current partial week):
    <input type="number" id="weeks" min="0" step="1" value="2">
  </label>

  <label>
    Time remaining in current week (IRL minutes, 0–30):
    <input type="number" id="remaining" min="0" max="30" step="1" value="20">
  </label>

  <button id="calcBtn">Start Countdown</button>
  <div class="error" id="error"></div>
  <div class="result" id="output"></div>
  <div class="countdown" id="countdown"></div>

  <script>
    // Common timezone list
    const timezones = [
      "UTC","Asia/Kolkata","Asia/Tokyo","Asia/Shanghai","Asia/Dubai",
      "Europe/London","Europe/Paris","Europe/Berlin","Europe/Moscow",
      "America/New_York","America/Chicago","America/Denver","America/Los_Angeles",
      "America/Sao_Paulo","Australia/Sydney","Africa/Johannesburg"
    ];

    const tzSelect = document.getElementById('timezone');
    timezones.forEach(tz => {
      const opt = document.createElement('option');
      opt.value = tz;
      opt.textContent = tz;
      tzSelect.appendChild(opt);
    });

    // Auto-select local timezone
    const localTZ = Intl.DateTimeFormat().resolvedOptions().timeZone;
    if (timezones.includes(localTZ)) {
      tzSelect.value = localTZ;
    } else {
      const opt = document.createElement('option');
      opt.value = localTZ;
      opt.textContent = localTZ + " (detected)";
      tzSelect.appendChild(opt);
      tzSelect.value = localTZ;
    }

    let countdownInterval;

    function clamp(x, min, max) {
      return Math.max(min, Math.min(max, x));
    }

    function calculate() {
      clearInterval(countdownInterval); // reset any previous countdown

      const tz = tzSelect.value;
      const weeks = Math.max(0, parseInt(document.getElementById('weeks').value, 10) || 0);
      const remaining = clamp(parseFloat(document.getElementById('remaining').value) || 0, 0, 30);

      const fullFutureWeeks = Math.max(weeks - 1, 0);
      const totalMinutes = fullFutureWeeks * 30 + remaining;

      const now = new Date();
      const endTime = new Date(now.getTime() + totalMinutes * 60000);

      const options = {
        timeZone: tz,
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit',
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      };
      const localEnd = endTime.toLocaleString([], options);

      document.getElementById('output').innerHTML =
        `Total real time: ${totalMinutes} minutes<br>` +
        `Ends at local time (${tz}): ${localEnd}`;

      // Start live countdown
      countdownInterval = setInterval(() => {
        const now = new Date();
        const diff = endTime - now;

        if (diff <= 0) {
          clearInterval(countdownInterval);
          document.getElementById('countdown').textContent = "Countdown finished!";
          return;
        }

        const hrs = Math.floor(diff / (1000 * 60 * 60));
        const mins = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
        const secs = Math.floor((diff % (1000 * 60)) / 1000);

        document.getElementById('countdown').textContent =
          `Time left: ${hrs}h ${mins}m ${secs}s`;
      }, 1000);
    }

    document.getElementById('calcBtn').addEventListener('click', calculate);
  </script>
</body>
</html>
